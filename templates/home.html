{% extends './base.html' %}

{% block title %}Home - Personal Blog{% endblock %}

{% block extra_css %}
<style>
    /* Keep all existing styles from the original home.html */
    .modal-styles,
    .post-modal,
    .modal-content,
    .modal-header,
    .modal-actions,
    .modal-btn,
    .modal-body,
    .modal-post-meta,
    .modal-post-title,
    .modal-post-image,
    .modal-post-content,
    .modal-footer,
    .modal-tags,
    .modal-tag,
    .modal-actions-footer,
    .reading-progress,
    .card-modern,
    .read-more-overlay,
    .read-more-btn,
    .modal-loading,
    .loading-spinner {
        /* All styles from previous home.html remain the same */
    }

    /* Additional styles for updated homepage */
    .view-all-section {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 4rem 0;
        margin: 4rem 0;
        border-radius: 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .view-all-section::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: pulse-rotate 8s ease-in-out infinite;
    }

    @keyframes pulse-rotate {
        0%, 100% { transform: scale(1) rotate(0deg); }
        50% { transform: scale(1.1) rotate(180deg); }
    }

    .view-all-section .container {
        position: relative;
        z-index: 2;
    }

    .view-all-section h2 {
        font-family: 'Playfair Display', serif;
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
    }

    .view-all-section p {
        font-size: 1.25rem;
        margin-bottom: 2rem;
        opacity: 0.95;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }

    .btn-view-all {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid white;
        color: white;
        padding: 1rem 3rem;
        font-size: 1.125rem;
        font-weight: 600;
        border-radius: 3rem;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(10px);
    }

    .btn-view-all::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.2);
        transition: left 0.5s ease;
    }

    .btn-view-all:hover::before {
        left: 100%;
    }

    .btn-view-all:hover {
        background: white;
        color: var(--primary-color);
        transform: translateY(-3px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
    }

    /* Featured posts section styling */
    .featured-section {
        margin: 4rem 0;
    }

    .featured-posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    /* Recent posts styling - limit to 3 posts */
    .recent-posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    /* Enhanced card styles */
    .post-card-enhanced {
        background: var(--background-white);
        border-radius: 1.5rem;
        overflow: hidden;
        box-shadow: var(--shadow-light);
        transition: all 0.4s ease;
        position: relative;
        cursor: pointer;
        border: 2px solid transparent;
    }

    .post-card-enhanced:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: var(--shadow-large);
        border-color: var(--primary-color);
    }

    .post-card-enhanced .card-img-top {
        height: 240px;
        object-fit: cover;
        transition: transform 0.4s ease;
    }

    .post-card-enhanced:hover .card-img-top {
        transform: scale(1.1);
    }

    .post-card-enhanced .card-body {
        padding: 2rem;
        position: relative;
    }

    .post-card-enhanced .card-title {
        font-family: 'Playfair Display', serif;
        font-size: 1.4rem;
        font-weight: 600;
        margin-bottom: 1rem;
        line-height: 1.3;
        color: var(--text-dark);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .post-card-enhanced .card-text {
        color: var(--text-gray);
        margin-bottom: 1.5rem;
        line-height: 1.6;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .post-card-enhanced .card-meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 0.875rem;
        color: var(--text-gray);
        border-top: 1px solid var(--border-light);
        padding-top: 1rem;
    }

    .post-card-enhanced .meta-left {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .post-card-enhanced .meta-right {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--primary-color);
        font-weight: 500;
    }

    /* Reading indicator */
    .reading-indicator {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        background: var(--primary-color);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 500;
    }

    /* Category badge */
    .category-badge {
        position: absolute;
        top: 1rem;
        left: 1rem;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 500;
        backdrop-filter: blur(10px);
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .featured-posts-grid,
        .recent-posts-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .view-all-section h2 {
            font-size: 2rem;
        }

        .view-all-section p {
            font-size: 1.125rem;
        }

        .btn-view-all {
            padding: 0.875rem 2rem;
            font-size: 1rem;
        }

        .post-card-enhanced .card-body {
            padding: 1.5rem;
        }

        .post-card-enhanced .card-title {
            font-size: 1.25rem;
        }
    }

    /* Loading animation for new posts */
    .post-enter {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }

    .post-enter-active {
        opacity: 1;
        transform: translateY(0) scale(1);
        transition: all 0.6s cubic-bezier(0.23, 1, 0.320, 1);
    }

    /* Newsletter section enhancement */
    .newsletter-enhanced {
        position: relative;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        overflow: hidden;
    }

    .newsletter-enhanced::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill=%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M30 30c0-11.046 8.954-20 20-20v40c-11.046 0-20-8.954-20-20zM0 30c0 11.046 8.954 20 20 20V10C8.954 10 0 18.954 0 30z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
    }

    /* Quick stats enhancement */
    .quick-stats {
        background: var(--background-white);
        border-radius: 2rem;
        padding: 3rem 0;
        margin: 4rem 0;
        position: relative;
        overflow: hidden;
    }

    .quick-stats::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent 0%, rgba(37, 99, 235, 0.03) 50%, transparent 100%);
    }

    .quick-stats .container {
        position: relative;
        z-index: 2;
    }

    .stat-item-enhanced {
        text-align: center;
        padding: 2rem;
        background: linear-gradient(135deg, var(--background-cream) 0%, var(--background-white) 100%);
        border-radius: 1.5rem;
        box-shadow: var(--shadow-light);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-item-enhanced::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.1), transparent);
        transition: left 0.5s ease;
    }

    .stat-item-enhanced:hover::before {
        left: 100%;
    }

    .stat-item-enhanced:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: var(--shadow-medium);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        color: white;
        font-size: 1.5rem;
        position: relative;
        z-index: 2;
    }
</style>
{% endblock %}

{% block content %}
    <!-- Reading Progress Bar -->
    <div class="reading-progress" id="reading-progress"></div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="hero-content">
                        <h1 class="fade-in">Welcome to My Personal Blog</h1>
                        <p class="lead fade-in">Discover stories, insights, and experiences that inspire and inform. Join me on this journey of creativity and learning.</p>
                        <div class="fade-in">
                            <a href="{% url 'myapp:all_posts' %}" class="btn-primary-custom">Explore Posts</a>
                            <a href="{% url 'myapp:about' %}" class="btn-outline-custom">Learn More</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="hero-image text-center fade-in">
                        <i class="fas fa-blog" style="font-size: 12rem; color: var(--primary-color); opacity: 0.1;"></i>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Quick Stats Section -->
    <section class="quick-stats">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-3">
                    <div class="stat-item-enhanced fade-in">
                        <div class="stat-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <span class="stat-number">{{ total_posts|default:"0" }}</span>
                        <span class="stat-label">Blog Posts</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item-enhanced fade-in">
                        <div class="stat-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <span class="stat-number">{{ total_categories|default:"0" }}</span>
                        <span class="stat-label">Categories</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item-enhanced fade-in">
                        <div class="stat-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <span class="stat-number">{{ total_views|default:"0" }}</span>
                        <span class="stat-label">Total Views</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item-enhanced fade-in">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <span class="stat-number">{{ total_subscribers|default:"0" }}</span>
                        <span class="stat-label">Subscribers</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Posts (if any) -->
    {% if featured_posts %}
    <section class="featured-section">
        <div class="container">
            <h2 class="section-title fade-in">Featured Posts</h2>
            <div class="featured-posts-grid">
                {% for post in featured_posts|slice:":3" %}
                <article class="post-card-enhanced fade-in" data-post-slug="{{ post.slug }}">
                    {% if post.featured_image %}
                    <img src="{{ post.featured_image.url }}" class="card-img-top" alt="{{ post.title }}">
                    {% else %}
                    <div class="card-img-top d-flex align-items-center justify-content-center" 
                         style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white;">
                        <i class="fas fa-image fa-3x"></i>
                    </div>
                    {% endif %}
                    
                    {% if post.category %}
                    <div class="category-badge">{{ post.category.name }}</div>
                    {% endif %}
                    
                    <div class="card-body">
                        <h3 class="card-title">
                            <a href="{{ post.get_absolute_url }}" class="text-decoration-none text-dark">
                                {{ post.title }}
                            </a>
                        </h3>
                        <p class="card-text">{{ post.excerpt|default:post.content|truncatewords:20|striptags }}</p>
                        
                        <div class="card-meta">
                            <div class="meta-left">
                                <span><i class="fas fa-user me-1"></i>{{ post.author.username }}</span>
                                <span><i class="fas fa-calendar me-1"></i>{{ post.published_at|date:"M d, Y" }}</span>
                            </div>
                            <div class="meta-right">
                                <i class="fas fa-eye me-1"></i>{{ post.views }}
                            </div>
                        </div>

                    </div>
                </article>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    {% comment %} <!-- Recent Posts - Limited to 3 -->
    <section id="recent-posts" class="py-5">
        <div class="container">
            <h2 class="section-title fade-in">Latest Posts</h2>
            {% if posts %}
            <div class="recent-posts-grid">
                {% for post in posts|slice:":3" %}
                <article class="post-card-enhanced fade-in" data-post-slug="{{ post.slug }}">
                    {% if post.featured_image %}
                    <img src="{{ post.featured_image.url }}" class="card-img-top" alt="{{ post.title }}">
                    {% else %}
                    <div class="card-img-top d-flex align-items-center justify-content-center" 
                         style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white;">
                        <i class="fas fa-image fa-3x"></i>
                    </div>
                    {% endif %}
                    
                    {% if post.category %}
                    <div class="category-badge">{{ post.category.name }}</div>
                    {% endif %}
                    
                    <div class="card-body">
                        <h3 class="card-title">
                            <a href="{{ post.get_absolute_url }}" class="text-decoration-none text-dark">
                                {{ post.title }}
                            </a>
                        </h3>
                        <p class="card-text">{{ post.excerpt|default:post.content|truncatewords:20|striptags }}</p>
                        
                        <div class="card-meta">
                            <div class="meta-left">
                                <span><i class="fas fa-user me-1"></i>{{ post.author.username }}</span>
                                <span><i class="fas fa-calendar me-1"></i>{{ post.published_at|date:"M d, Y" }}</span>
                            </div>
                            <div class="meta-right">
                                <i class="fas fa-eye me-1"></i>{{ post.views }}
                            </div>
                        </div>
                        
                        <div class="reading-indicator">
                            <i class="fas fa-clock me-1"></i>{% widthratio post.content|wordcount 200 1 %} min read
                        </div>

                    </div>
                </article>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center fade-in">
                <div style="font-size: 4rem; color: var(--border-light); margin-bottom: 2rem;">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h3 style="color: var(--text-gray);">No Posts Yet</h3>
                <p style="color: var(--text-gray);">The blog is just getting started. Check back soon for amazing content!</p>
            </div>
            {% endif %}
        </div>
    </section> {% endcomment %}

    <!-- View All Posts CTA -->
    <section class="view-all-section fade-in">
        <div class="container">
            <h2>Discover More Stories</h2>
            <p>Explore our complete collection of articles, tutorials, and insights. There's always something new to learn and discover.</p>
            <a href="{% url 'myapp:all_posts' %}" class="btn-view-all">
                <span>View All Posts</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="container">
            <div class="about-content fade-in">
                <h2 class="section-title">About Me</h2>
                <p>Welcome to my personal blog where I share my thoughts, experiences, and insights on technology, life, and everything in between. I'm passionate about creating meaningful content that resonates with readers and sparks interesting conversations.</p>
                <p>Through this platform, I aim to connect with like-minded individuals, share knowledge, and build a community of learners and creators.</p>
                <div class="text-center mt-4">
                    <a href="{% url 'myapp:about' %}" class="btn-primary-custom">
                        <i class="fas fa-user me-2"></i>Learn More About Me
                    </a>
                </div>
            </div>
        </div>
    </section> 

    <!-- Newsletter Section -->
    <section class="newsletter-section newsletter-enhanced">
        <div class="container">
            <div class="text-center">
                <h2 class="section-title text-white mb-4">Stay Updated</h2>
                <p class="lead mb-4">Subscribe to my newsletter and never miss a post. Get the latest articles delivered straight to your inbox.</p>
                <form method="post" action="{% url 'myapp:subscribe_newsletter' %}" class="newsletter-form">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="email" name="email" class="form-control" placeholder="Enter your email address" required>
                        <button class="btn btn-light" type="submit">
                            <i class="fas fa-paper-plane me-2"></i>Subscribe
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enhanced post card interactions
    document.querySelectorAll('.post-card-enhanced').forEach(card => {
        card.addEventListener('click', function(e) {
            // Don't navigate if clicking on links
            if (e.target.tagName === 'A' || e.target.closest('a')) {
                return;
            }
            
            const postSlug = this.dataset.postSlug;
            if (postSlug) {
                const postUrl = `/post/${postSlug}/`;
                
                // Add loading state
                this.style.opacity = '0.8';
                this.style.transform = 'scale(0.98)';
                
                // Navigate after a short delay for visual feedback
                setTimeout(() => {
                    window.location.href = postUrl;
                }, 150);
            }
        });

        // Enhanced hover effects
        card.addEventListener('mouseenter', function() {
            this.querySelector('.reading-indicator').style.transform = 'translateY(-5px)';
        });

        card.addEventListener('mouseleave', function() {
            this.querySelector('.reading-indicator').style.transform = 'translateY(0)';
        });
    });

    // Intersection Observer for animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
                setTimeout(() => {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }, index * 100);
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    // Apply animations to all fade-in elements
    document.querySelectorAll('.fade-in').forEach((el, index) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = `all 0.6s cubic-bezier(0.23, 1, 0.320, 1) ${index * 0.1}s`;
        observer.observe(el);
    });

    // Stats counter animation
    const stats = document.querySelectorAll('.stat-number');
    const statsObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const target = entry.target;
                const finalValue = parseInt(target.textContent) || 0;
                animateCounter(target, 0, finalValue);
                statsObserver.unobserve(target);
            }
        });
    }, { threshold: 0.5 });

    stats.forEach(stat => statsObserver.observe(stat));

    function animateCounter(element, start, end) {
        const duration = 2000;
        const startTime = performance.now();
        
        function updateCounter(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const current = Math.floor(start + (end - start) * progress);
            
            element.textContent = current;
            
            if (progress < 1) {
                requestAnimationFrame(updateCounter);
            }
        }
        
        requestAnimationFrame(updateCounter);
    }

    // Smooth scrolling for internal links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Enhanced newsletter form submission
    const newsletterForm = document.querySelector('.newsletter-form');
    if (newsletterForm) {
        newsletterForm.addEventListener('submit', function(e) {
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Subscribing...';
            submitBtn.disabled = true;
            
            // The form will submit normally, but we provide visual feedback
            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 3000);
        });
    }

    // Reading time calculation enhancement
    document.querySelectorAll('.reading-indicator').forEach(indicator => {
        const card = indicator.closest('.post-card-enhanced');
        const contentText = card.querySelector('.card-text').textContent;
        const wordCount = contentText.split(/\s+/).length;
        const readingTime = Math.ceil(wordCount / 200); // 200 words per minute
        
        indicator.innerHTML = `<i class="fas fa-clock me-1"></i>${readingTime} min read`;
    });

    // Parallax effect for hero section
    window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;
        const hero = document.querySelector('.hero-section');
        if (hero && scrolled < window.innerHeight) {
            hero.style.transform = `translateY(${scrolled * 0.3}px)`;
        }
    });

    // Auto-hide messages after 5 seconds
    setTimeout(() => {
        document.querySelectorAll('.alert').forEach(alert => {
            if (window.bootstrap && window.bootstrap.Alert) {
                const bsAlert = new window.bootstrap.Alert(alert);
                bsAlert.close();
            } else {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            }
        });
    }, 5000);

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Press 'h' to go to top
        if (e.key === 'h' && !e.ctrlKey && !e.metaKey && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
            e.preventDefault();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Press 'b' to go to blog posts
        if (e.key === 'b' && !e.ctrlKey && !e.metaKey && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
            e.preventDefault();
            const allPostsLink = document.querySelector('a[href*="all_posts"], a[href*="blog"]');
            if (allPostsLink) {
                window.location.href = allPostsLink.href;
            }
        }
    });

    // Add loading states for better UX
    document.addEventListener('click', function(e) {
        if (e.target.tagName === 'A' && !e.target.getAttribute('href').startsWith('#')) {
            e.target.style.opacity = '0.7';
        }
    });

    // Performance: Lazy loading for images if Intersection Observer is supported
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.classList.add('loaded');
                        imageObserver.unobserve(img);
                    }
                }
            });
        });

        // Apply to any images with data-src attribute
        document.querySelectorAll('img[data-src]').forEach(img => {
            imageObserver.observe(img);
        });
    }
});
</script>
{% endblock %}